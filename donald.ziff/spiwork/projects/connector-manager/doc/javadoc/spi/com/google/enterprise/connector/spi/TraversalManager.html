<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.4.2_13) on Thu Jul 19 08:54:57 PDT 2007 -->
<TITLE>
TraversalManager
</TITLE>

<META NAME="keywords" CONTENT="com.google.enterprise.connector.spi.TraversalManager interface">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="TraversalManager";
}
</SCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/TraversalManager.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/TraversalContextAware.html" title="interface in com.google.enterprise.connector.spi"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/Value.html" title="class in com.google.enterprise.connector.spi"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="TraversalManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
com.google.enterprise.connector.spi</FONT>
<BR>
Interface TraversalManager</H2>
<HR>
<DL>
<DT>public interface <B>TraversalManager</B></DL>

<P>
Interface for implementing query-based traversal.
 <p>
 Query-based traversal is a scheme whereby a repository is traversed according
 to a query that visits each document in a natural order that is efficiently
 supported by the underlying repository and can be easily checkpointed and
 restarted.
 <p>
 A good use case is a repository that supports access to documents in
 last-modified-date order. In particular, suppose a repository supports a
 query analogous to the following SQL query (the repository need not support
 SQL, SQL is used here only as an example):
 <p>
 
 <pre>
        select documentid, lastmodifydate from documents 
        where  lastmodifydate &lt; &lt;b&gt;&lt;i&gt;date-constant&lt;/i&gt;&lt;/b&gt; 
        order by lastmodifydate
 </pre>
 
 <p>
 Such a repository can easily be traversed by lastmodifydate, and the state of
 the traversal is easily encapsulated in a single, small data item: the date
 of the last document processed. Increasing last-modified-date order is
 convenient because if a document is processed during traversal, but then
 later modified, then it will be picked up again later in the traversal
 process. Thus, this traversal is appropriate both for initial load and for
 incremental update.
 <p>
 For such a repository, the implementor is urged to let the Connector Manager
 (the caller) maintain the traversal state. This is achieved by implementing
 the interface methods as follows:
 <ul>
 <li><code>startTraversal()</code> Run a query that starts from the
 beginning, such as <br>
 <code>
 select documentid, lastmodifydate from documents order by lastmodifydate
 </code>
 <li><code>checkpoint(PropertyMap pm)</code> Extract the lastmodifydate
 from the document that the caller passes in to you as a property map, encode
 it as a string, and return it
 <li><code>resumeTraversal(String checkpoint)</code> Run a query that
 resumes traversal from the supplied checkpoint
 </ul>
 Please observe that the Connector Manager (the caller) makes no guarantee to
 consume the entire PropertyMapList returned by either the startTraversal or
 resumeTraversal calls. The Connector Manager will consume as many it chooses,
 depending on load, schedule and other factors. The Connector Manager
 guarantees to call checkpoint() supplying the last document it has
 successfully processed from the PropertyMapList it was using. Thus, the
 implementor is free to use a query that only returns a small number of
 results, if that gets better performance.
 <p>
 For example, to continue the SQL analogy, a query like this could be used:
 
 <pre>
        select TOP 10 documentid, lastmodifydate from documents ...
 </pre>
 
 The <code>setBatchHint</code> method is provided so that the Connector
 Manager can tell the implementation that it only wants that many results per
 call. This is a hint - the implementation need not observe it. The
 implementation is free to return a PropertyMapList with fewer or more
 results. For example, the traversal may be completely up to date, so perhaps
 there are no results to return. Or, for internal reasons, the implementation
 may not want to return the full batchHint number of results. Probably,
 returning zero results will have impact on scheduling - the Connector Manager
 may choose to wait longer after receiving zero results before it calls again.
 But implementations are free to return zero results if they choose. Also, if
 zero results are returned, the Connector Manager will probably not call
 <code>checkpoint</code> before calling start or resume traversal again.
 <p>
 An implementation need not let the Connector Manager store the traversal
 state, it may choose to store the state itself. Implementors are discouraged
 from using this technique unless necessary, because it makes transactionality
 more difficult and it introduces resource dependencies of which the Connector
 Manager is unaware. However, there may be repositories which have a natural
 traversal order, but this state of this traversal is not easily expressed in
 a small data item. For example, a repository may consist of a large number of
 named sub-repositories, each of which can be traversed in modify date order,
 but for which there is no convenient way of traversing them all in one query.
 In this case, the implementation may choose to maintain state itself, as a
 table of pairs: (sub-repository-name, per-repository-date-stamp). In such a
 case, the implementor may implement the interface methods as follows:
 <ul>
 <li><code>startTraversal()</code> Clear the internal state. Return the
 first few documents
 <li><code>checkpoint(PropertyMap pm)</code> This can be taken as a signal
 from the Connector Manager that documents have been successfully processed,
 up to the last one reported. The implementation can now commit a change to
 external store bringing it up to that document. A null String may be
 returned, which signals to the Connector Manager that it need not bother to
 store any state on the implementation's behalf. Or the implementation may
 return a diagnostic string.
 <li><code>resumeTraversal(String checkpoint)</code> Resume traversal
 according to the internal state of the implementation. The Connector Manager
 will pass in whatever checkpoint String was returned by the last call to
 checkpoint - but the implementation is free to ignore this and use its
 internal state.
 </ul>
 The implementation must be careful about when and how it commits its internal
 state to external storage. Remember again that the Connector Manager makes no
 guarantee to consume the entire result set return by a traversal call. So the
 implementation should wait until the checkpoint call, examine the parameter
 passed in and only commit the state up to that document.
 <p>
 <b> Note on "Metadata and URL" feeds vs. Content feeds </b>
 <p>
 Some repositories are fully web-enabled but are difficult or impossible for
 the Search Appliance to crawl, because they make heavy use of ASP or JSP, or
 they have a metadata model that is not conveniently accessible with the
 content in a single page. Such repositories are good candidates for
 connectors. However, a developer may not choose to implement authentication
 and authorization through a connector. It may be sufficient to use standard
 web mechanisms for these tasks.
 </p>
 <p>
 The developer can achieve this by following these steps. In the property map
 returned by the traversal methods, specify the <A HREF="../../../../../com/google/enterprise/connector/spi/SpiConstants.html" title="class in com.google.enterprise.connector.spi"><CODE>SpiConstants</CODE></A>.PROPNAME_SEARCHURL
 property. The value should be a URL. If this property is specified, the
 Connector Manager will use a "URL Feed" rather than a "Content Feed" for that
 document. In this case, the implementor should NOT supply the content of the
 document. The Search Appliance will fetch the content from the specified URL.
 Also, this URL will be used to trigger normal authentication and
 authorization for that document. For more details, see the documentation on
 Metadata and URL Feeds.
 <p>
 <b>Note on property maps returned by traversal calls</b>
 <p>
 The property maps returned by the queries defined here represent documents.
 They must contain special properties according to the following rules:
 <ul>
 <li> <A HREF="../../../../../com/google/enterprise/connector/spi/SpiConstants.html" title="class in com.google.enterprise.connector.spi"><CODE>SpiConstants</CODE></A>.PROPNAME_DOCID This property must be present.
 <li> <A HREF="../../../../../com/google/enterprise/connector/spi/SpiConstants.html" title="class in com.google.enterprise.connector.spi"><CODE>SpiConstants</CODE></A>.PROPNAME_SEARCHURL If present, this means that the
 Connector Manager will generate a Metadata and URL feed, with the specified
 URL. If this is present, then the PROPNAME_CONTENT property should NOT be.
 <li> <A HREF="../../../../../com/google/enterprise/connector/spi/SpiConstants.html" title="class in com.google.enterprise.connector.spi"><CODE>SpiConstants</CODE></A>.PROPNAME_CONTENT This property should hold the
 content of the document. If present, the connector framework will base-64
 encode the value and present it to the Search Appliance as the primary
 content to be indexed. If this is present, then the PROPNAME_SEARCHURL
 property should NOT be.
 <li> <A HREF="../../../../../com/google/enterprise/connector/spi/SpiConstants.html" title="class in com.google.enterprise.connector.spi"><CODE>SpiConstants</CODE></A>.PROPNAME_DISPLAYURL If present, this will be used
 as the primary link on a results page. This should NOT be used with
 PROPNAME_SEARCHURL.
 </ul>
<P>

<P>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->


<!-- =========== FIELD SUMMARY =========== -->


<!-- ======== CONSTRUCTOR SUMMARY ======== -->


<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/DocumentList.html" title="interface in com.google.enterprise.connector.spi">DocumentList</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/enterprise/connector/spi/TraversalManager.html#resumeTraversal(java.lang.String)">resumeTraversal</A></B>(java.lang.String&nbsp;checkPoint)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Continues traversal from a supplied checkpoint.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/enterprise/connector/spi/TraversalManager.html#setBatchHint(int)">setBatchHint</A></B>(int&nbsp;batchHint)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sets the preferred batch size.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/DocumentList.html" title="interface in com.google.enterprise.connector.spi">DocumentList</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/enterprise/connector/spi/TraversalManager.html#startTraversal()">startTraversal</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Starts (or restarts) traversal from the beginning.</TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->


<!-- ========= CONSTRUCTOR DETAIL ======== -->


<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Method Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="startTraversal()"><!-- --></A><H3>
startTraversal</H3>
<PRE>
public <A HREF="../../../../../com/google/enterprise/connector/spi/DocumentList.html" title="interface in com.google.enterprise.connector.spi">DocumentList</A> <B>startTraversal</B>()
                            throws <A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></PRE>
<DL>
<DD>Starts (or restarts) traversal from the beginning. This action will return
 objects starting from the very oldest, or with the smallest IDs, or
 whatever natural order the implementation prefers. The caller may consume
 as many or as few of the results as it wants, but it guarantees to call
 <code><CODE>DocumentList#checkpoint()</CODE></code> passing in the last object
 it has successfully processed.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>A DocumentList of documents from the repository in natural order,
         or null if there are no documents.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></CODE> - if the Repository is unreachable or similar
         exceptional condition.</DL>
</DD>
</DL>
<HR>

<A NAME="resumeTraversal(java.lang.String)"><!-- --></A><H3>
resumeTraversal</H3>
<PRE>
public <A HREF="../../../../../com/google/enterprise/connector/spi/DocumentList.html" title="interface in com.google.enterprise.connector.spi">DocumentList</A> <B>resumeTraversal</B>(java.lang.String&nbsp;checkPoint)
                             throws <A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></PRE>
<DL>
<DD>Continues traversal from a supplied checkpoint. The checkPoint parameter
 will have been created by a call to the
 <code><CODE>DocumentList#checkpoint()</CODE></code> method. The
 PropertyMapList object returns objects from the repository in natural order
 starting just after the document that was used to create the checkpoint
 string.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>checkPoint</CODE> - String that indicates from where to resume traversal.
<DT><B>Returns:</B><DD>DocumentList object that returns documents starting just after the
         checkpoint, or null if there are no documents.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></CODE></DL>
</DD>
</DL>
<HR>

<A NAME="setBatchHint(int)"><!-- --></A><H3>
setBatchHint</H3>
<PRE>
public void <B>setBatchHint</B>(int&nbsp;batchHint)
                  throws <A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></PRE>
<DL>
<DD>Sets the preferred batch size. The caller advises the implementation that
 the result sets returned by startTraversal or resumeTraversal need not be
 larger than this number. The implementation may ignore this call or do its
 best to return approximately this number.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>batchHint</CODE> - 
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/enterprise/connector/spi/RepositoryException.html" title="class in com.google.enterprise.connector.spi">RepositoryException</A></CODE></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/TraversalManager.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/TraversalContextAware.html" title="interface in com.google.enterprise.connector.spi"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../com/google/enterprise/connector/spi/Value.html" title="class in com.google.enterprise.connector.spi"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="TraversalManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
