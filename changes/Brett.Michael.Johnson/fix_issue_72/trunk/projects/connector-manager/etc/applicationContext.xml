<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<bean id="ApplicationContextProperties"
		class="java.lang.String">
		<constructor-arg value="/WEB-INF/applicationContext.properties"/>
	</bean>

	<bean id="EncryptedPropertyPlaceholderConfigurer"
		class="com.google.enterprise.connector.instantiator.EncryptedPropertyPlaceholderConfigurer">
		<property name="location" ref="ApplicationContextProperties"/>
	</bean>	

	<bean id="FeedConnection"
		class="com.google.enterprise.connector.pusher.GsaFeedConnection">
		<constructor-arg index="0" type="java.lang.String"
			value="${gsa.feed.host}" />
		<constructor-arg index="1" type="int" value="${gsa.feed.port}" />
	</bean>

	<bean id="Pusher"
		class="com.google.enterprise.connector.pusher.DocPusher">
		<constructor-arg index="0" ref="FeedConnection" />
	</bean>

	<!-- Create a Handler for the Feed Logger and add it to the logger -->
	<bean id="FeedFormatter" class="java.util.logging.SimpleFormatter" />

	<bean id="FeedHandler" class="com.google.enterprise.connector.pusher.FeedFileHandler">
		<constructor-arg index="0" value="${catalina.base}/logs/google-connectors.feed%g.log" />
		<constructor-arg index="1" value="52428800" />
		<constructor-arg index="2" value="10" />
		<property name="level" value="FINER" />
		<property name="encoding" value="UTF-8" />
		<property name="formatter" ref="FeedFormatter" />
	</bean>

	<bean id="FeedWrapperLogger" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="staticMethod"
			value="com.google.enterprise.connector.pusher.DocPusher.getFeedLogger" />
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="FeedWrapperLogger" />
		<property name="targetMethod" value="addHandler" />
		<property name="arguments">
			<list>
				<ref bean="FeedHandler" />
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="FeedWrapperLogger" />
		<property name="targetMethod" value="setUseParentHandlers" />
		<property name="arguments">
			<list>
				<value>false</value>
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="FeedWrapperLogger" />
		<property name="targetMethod" value="setLevel" />
		<property name="arguments">
			<list>
				<value>${feedLoggingLevel}</value>
			</list>
		</property>
	</bean>

	<bean id="ConnectorScheduleStore"
		class="com.google.enterprise.connector.persist.PrefsStore">
	</bean>

	<bean id="ConnectorStateStore"
		class="com.google.enterprise.connector.persist.PrefsStore" />

	<bean id="Instantiator"
		class="com.google.enterprise.connector.instantiator.SpringInstantiator">
		<constructor-arg ref="Pusher" />
		<constructor-arg ref="ConnectorStateStore" />
	</bean>

	<bean id="Monitor"
		class="com.google.enterprise.connector.monitor.HashMapMonitor" />

	<bean id="WorkQueue"
		class="com.google.enterprise.connector.common.WorkQueue">
		<constructor-arg index="0" type="int" value="20" />
	</bean>

	<bean id="Manager"
		class="com.google.enterprise.connector.manager.ProductionManager">
		<property name="connectorScheduleStore"
			ref="ConnectorScheduleStore" />
		<property name="connectorStateStore"
			ref="ConnectorStateStore" />
		<property name="scheduler"
			ref="TraversalScheduler" />
		<property name="instantiator" ref="Instantiator" />
	</bean>

	<bean id="TraversalScheduler"
		class="com.google.enterprise.connector.scheduler.TraversalScheduler">
		<constructor-arg index="0" ref="Instantiator" />
		<constructor-arg index="1" ref="Monitor" />
		<constructor-arg index="2" ref="WorkQueue" />
		<constructor-arg index="3" ref="ConnectorScheduleStore" />
	</bean>

  <bean id="TraversalContext"
		 class="com.google.enterprise.connector.traversal.ProductionTraversalContext">
    <property name="fileSizeLimitInfo" ref="FileSizeLimitInfo" />
    <property name="mimeTypeMap" ref="MimeTypeMap" />
  </bean>

  <bean id="FileSizeLimitInfo"
		 class="com.google.enterprise.connector.traversal.FileSizeLimitInfo">
    <!-- Maximum file size accepted by the GSA is 30MB -->
    <property name="maxDocumentSize" value="31457280" />
  </bean>

  <bean id="MimeTypeMap"
		 class="com.google.enterprise.connector.traversal.MimeTypeMap">
    <property name="unknownMimeTypeSupportLevel" value="2" />
    <property name="extensionToMimeType" value="/WEB-INF/ext2mimetype.txt" />
    <property name="preferredMimeTypes">
      <!-- Sets the preferred mime types to index.
           These mime types require little or no preprocessing
           or file format conversion to extract text and metadata.
      -->
      <set>
        <!-- Prefer plain text, html, sgml, & xml types  -->
        <value>application/plain</value>
        <value>application/rdf+xml</value>
        <value>application/xhtml+xml</value>
        <value>application/xml</value>
        <value>text/calendar</value>
        <value>text/csv</value>
        <value>text/plain</value>
        <value>text/html</value>
        <value>text/sgml</value>
        <value>text/x-sgml</value>
        <value>text/tab-separated-values</value>
        <value>text/xhtml</value>
        <value>text/xml</value>
        <value>message/http</value>
        <value>message/s-http</value>
        <value>message/news</value>
      </set>
    </property>
    <property name="supportedMimeTypes">
      <!--  Sets the supported mime types to index.
            These mime types may require some preprocessing or
            file format conversion to extract text and metadata.
            Some information may be lost or discarded.
      -->
      <set>
        <!-- Support various well-known document formats -->
        <value>text/richtext</value>
        <value>text/rtf</value>
        <value>application/rtf</value>
        <value>application/x-rtf</value>
        <value>text/troff</value>
        <value>application/x-troff</value>
        <value>application/pdf</value>
        <value>application/postscript</value>
        <value>application/vnd.framemaker</value>
        <value>application/vnd.kde.kpresenter</value>
        <value>application/vnd.kde.kspread</value>
        <value>application/vnd.kde.kword</value>
        <value>application/vnd.lotus-1-2-3</value>
        <value>application/vnd.lotus-freelance</value>
        <value>application/x-freelance</value>
        <value>application/vnd.lotus-notes</value>
        <value>application/vnd.lotus-wordpro</value>
        <value>application/vnd.oasis.opendocument.presentation</value>
        <value>application/vnd.oasis.opendocument.presentation-template</value>
        <value>application/vnd.oasis.opendocument.spreadsheet</value>
        <value>application/vnd.oasis.opendocument.spreadsheet-template</value>
        <value>application/vnd.oasis.opendocument.text</value>
        <value>application/vnd.oasis.opendocument.text-master</value>
        <value>application/vnd.oasis.opendocument.text-template</value>
        <value>application/vnd.oasis.opendocument.text-web</value>
        <value>application/vnd.quark.quarkxpress</value>
        <value>application/vnd.scibus</value>
        <value>application/vnd.wordperfect</value>
        <value>application/wordperfect</value>
        <value>application/wordperfect5.1</value>
        <value>application/wordperfect60</value>
        <value>application/wordperfect61</value>
        <value>application/vnd.visio</value>
        <value>application/x-visio</value>
        <value>application/x-latex</value>
        <value>application/x-tex</value>
        <value>application/x-texinfo</value>
        <value>application/x-pagemaker</value>
        <!-- Support various less-well-known document formats -->
        <value>application/excel</value>
        <value>application/vnd.ms-excel</value>
        <value>application/x-excel</value>
        <value>application/x-msexcel</value>
        <value>application/vnd.ms-htmlhelp</value>
        <value>application/mspowerpoint</value>
        <value>application/powerpoint</value>
        <value>application/vnd.ms-powerpoint</value>
        <value>application/vnd.ms-project</value>
        <value>application/x-project</value>
        <value>application/x-mspublisher</value>
        <value>application/x-msschedule</value>
        <value>application/msword</value>
        <value>application/vnd.ms-works</value>
        <value>application/mswrite</value>
        <value>application/x-mswrite</value>
        <value>application/vnd.ms-xpsdocument</value>
        <!-- Support multipart files with possibly supported subparts -->
        <value>mulitpart/appledouble</value>
        <value>mulitpart/mixed</value>
        <!-- Catch-all to support other text subtypes -->
        <value>text</value>
      </set>
    </property>
    <property name="unsupportedMimeTypes">
      <!-- Sets the unsupported mime types whose content cannot be indexed.
           These mime types provide little or no textual content, or are 
           data formats that are either unknown or do not have a format converter.
           The connector may still provide meta-data describing the content,
           but the content itself should not be pushed.
      -->
      <set>
        <!-- Don't feed non-text media types -->
        <value>audio</value>
        <value>image</value>
        <value>music</value>
        <value>x-music</value>
        <value>video</value>
        <!-- Don't feed binary executables -->
        <value>application/octet-stream</value>
        <value>application/macbinary</value>
        <value>application/x-binary</value>
        <!-- Don't feed compressed archives -->
        <value>application/binhex</value>
        <value>application/binhex4</value>
        <value>application/gnutar</value>
        <value>application/mac-binhex</value>
        <value>application/mac-binhex40</value>
        <value>application/sea</value>
        <value>application/x-binhex</value>
        <value>application/x-binhex40</value>
        <value>application/x-bzip</value>
        <value>application/x-bzip2</value>
        <value>application/x-compressed</value>
        <value>application/x-gtar</value>
        <value>application/x-gzip</value>
        <value>application/x-lzh</value>
        <value>application/x-sea</value>
        <value>application/x-sit</value>
        <value>application/x-stuffit</value>
        <value>application/x-tar</value>
        <value>application/x-zip</value>
        <value>application/x-zip-compressed</value>
        <value>application/zip</value>
        <value>multipart/x-zip</value>
        <!-- Types explicitly excluded in the default GSA Crawl and Index form. -->
        <value>application/annodex</value>
        <value>application/internet-property-stream</value>
        <value>application/mime</value>
        <value>application/pgp-signature</value>
        <value>application/solids</value>
        <value>application/vnd.acucorp</value>
        <value>application/vnd.koan</value>
        <value>application/vnd.ibm.modcap</value>
        <value>application/x-aim</value>
        <value>application/x-koan</value>
        <value>application/x-msaccess</value>
        <value>application/x-msdownload</value>
        <value>application/x-world</value>
        <value>message/rfc822</value>
        <value>text/asp</value>
        <value>text/vnd.abc</value>
        <value>text/x-audiosoft-intra</value>
        <value>text/x-asm</value>
        <!-- Catch-all for media types that are not explicitly mentioned above. -->
        <value>chemical</value>
        <value>example</value>
        <value>message</value>
        <value>model</value>
        <value>mulitpart</value>
        <value>world</value>
        <value>i-world</value>
        <value>x-world</value>
        <!-- Comment out the following if you want to classify other application
              subtypes as 'unknown mimetype' rather than 'unsupported mimetype'.
        -->
        <value>application</value> 
      </set>
    </property>
  </bean>
</beans>
